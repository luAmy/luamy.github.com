import{a4 as s,a5 as r}from"./__vendor-d29dd9de.js";import{s as l}from"./index-8e36ecf0.js";import{a as o}from"./_element-plus-22095640.js";s.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8";let a=[],m=s.CancelToken,i=e=>{for(let t in a)e.url.indexOf("upload")===-1&&a[t].u===e.url+"&"+e.method&&a[t].time+500<=new Date().getTime()&&(a[t].cancel(),a.splice(t,1))};const n=s.create({baseURL:"/api/",timeout:5e4,crossDomain:!0,withCredentials:!0});n.interceptors.request.use(e=>(i(e),e.cancelToken=new m(t=>{a.push({u:e.url+"&"+e.method,cancel:t,time:new Date().getTime()})}),r.start(),e.headers={...e.headers,"access-token":localStorage.getItem("ms_token")},e),e=>Promise.reject(e));n.interceptors.response.use(e=>(r.done(),i(e.config),e.status===200&&e.data.status===200?e.data:e.data.status===401?(location.hash!="#/login"&&(l.commit("logout"),window.location.href=window.location.origin+"/#/login"),Promise.reject(e.data.msg)):e.data.data?Promise.reject(e.data):(o({message:e.data.msg,type:"error",duration:5*1e3}),Promise.reject())),e=>{if(r.done(),!(e==="cancel"||!e.message))return o({message:e,type:"error",duration:5*1e3}),Promise.reject(e)});export{n as s};
