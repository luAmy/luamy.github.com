import{a4 as o,a5 as r}from"./__vendor-d29dd9de.js";import{s as m}from"./index-95e6467e.js";import{a as s}from"./_element-plus-33185897.js";o.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8";let a=[],l=o.CancelToken,i=e=>{for(let t in a)e.url.indexOf("upload")===-1&&a[t].u===e.url+"&"+e.method&&a[t].time+500<=new Date().getTime()&&(a[t].cancel(),a.splice(t,1))};const n=o.create({baseURL:"http://ktv.dongbaoyu.com/",timeout:5e4,crossDomain:!0,withCredentials:!0});n.interceptors.request.use(e=>(i(e),e.cancelToken=new l(t=>{a.push({u:e.url+"&"+e.method,cancel:t,time:new Date().getTime()})}),r.start(),e.headers={...e.headers,"access-token":localStorage.getItem("ms_token")},e),e=>Promise.reject(e));n.interceptors.response.use(e=>(r.done(),i(e.config),e.status===200&&e.data.status===200?e.data:e.data.status===401?(location.hash!="#/login"&&(m.commit("logout"),window.location.href=window.location.origin+"/#/login"),Promise.reject(e.data.msg)):e.data.data?Promise.reject(e.data):(s({message:e.data.msg,type:"error",duration:5*1e3}),Promise.reject())),e=>{if(r.done(),!(e==="cancel"||!e.message))return s({message:e,type:"error",duration:5*1e3}),Promise.reject(e)});export{n as s};
